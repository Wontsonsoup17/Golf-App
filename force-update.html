<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Updating... - Westchester Golf</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #0a0f0d; color: #e0e0e0; display: flex; align-items: center;
    justify-content: center; min-height: 100vh; text-align: center; padding: 24px;
  }
  .container { max-width: 340px; }
  .spinner {
    width: 48px; height: 48px; border: 4px solid rgba(255,255,255,0.1);
    border-top-color: #d4af37; border-radius: 50%; margin: 0 auto 20px;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  h2 { font-size: 18px; margin-bottom: 8px; color: #fff; }
  p { font-size: 13px; color: #999; line-height: 1.5; }
  .status { margin-top: 16px; font-size: 12px; color: #d4af37; font-weight: 600; }
</style>
</head>
<body>
<div class="container">
  <div class="spinner"></div>
  <h2>Updating App</h2>
  <p>Clearing cached data and loading the latest version...</p>
  <div class="status" id="status">Clearing caches...</div>
</div>

<script>
(function() {
  var statusEl = document.getElementById('status');

  function setStatus(msg) {
    if (statusEl) statusEl.textContent = msg;
  }

  // Step 1: Clear ALL localStorage
  try { localStorage.clear(); } catch(e) {}

  // Step 2: Clear ALL sessionStorage
  try { sessionStorage.clear(); } catch(e) {}

  // Step 3: Unregister ALL service workers
  var swPromise = Promise.resolve();
  if ('serviceWorker' in navigator) {
    swPromise = navigator.serviceWorker.getRegistrations().then(function(regs) {
      return Promise.all(regs.map(function(r) { return r.unregister(); }));
    }).catch(function() {});
  }

  // Step 4: Clear ALL Cache API caches
  var cachePromise = Promise.resolve();
  if (window.caches) {
    cachePromise = caches.keys().then(function(names) {
      return Promise.all(names.map(function(name) { return caches.delete(name); }));
    }).catch(function() {});
  }

  // Step 5: Wait for all clearing to complete, then redirect
  Promise.all([swPromise, cachePromise]).then(function() {
    setStatus('Caches cleared! Redirecting...');

    // Force a completely fresh load of login page with cache-busting
    var ts = Date.now();
    setTimeout(function() {
      window.location.replace('login.html?_forceclear=' + ts);
    }, 1000);
  }).catch(function() {
    setStatus('Done. Redirecting...');
    setTimeout(function() {
      window.location.replace('login.html?_forceclear=' + Date.now());
    }, 1000);
  });
})();
</script>
</body>
</html>
